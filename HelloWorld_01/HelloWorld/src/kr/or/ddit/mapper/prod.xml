<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">
	
<sqlMap namespace="prod">
	<select id="selectByRegion" resultClass="java.util.HashMap" parameterClass="String">
	  select b.prod_no, b.PROD_NAME, c.attraction_photo
		from
		(select prod_no, min(attraction_no) as attraction_no 
		from relationship
		group by prod_no) a, prod b, attraction c
		where a.prod_no = b.prod_no
		  and a.attraction_no = c.attraction_no
		  and c.attraction_region like  '%' || #region# || '%' 
		order by prod_no
	</select>
	
	<select id="selectByBigRegion" resultClass="java.util.HashMap">
	  select b.prod_no, b.PROD_NAME, c.attraction_photo
		from
		(select prod_no, min(attraction_no) as attraction_no 
		from relationship
			group by prod_no) a, prod b, attraction c
		where a.prod_no = b.prod_no
		  and a.attraction_no = c.attraction_no
		  and (c.attraction_region like '%특별시%'
		    or c.attraction_region like '%광역시%'
		    or c.attraction_region like '%세종특별자치%')
		order by prod_no
	</select>

	<select id="selectAll" resultClass="java.util.HashMap">
		select b.prod_no, b.prod_name, c.attraction_photo
		  from
		(select prod_no, min(attraction_no) as attraction_no 
		  from relationship
		group by prod_no) a, prod b, attraction c
		where a.prod_no = b.prod_no
		  and a.attraction_no = c.attraction_no
		order by prod_no
	</select>
</sqlMap>

